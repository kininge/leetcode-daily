# üß© Problem #3623 ‚Äì Count Number of Trapezoids I

**Difficulty:** Medium  
**Topics:** Geometry, Hash Map, Math, Prefix Sum  
**Link:** https://leetcode.com/problems/count-number-of-trapezoids-i/

---

## üìù Problem Summary

You are given a list of 2D points.  
A **horizontal trapezoid** is any quadrilateral with at least one pair of **horizontal sides**, i.e., two edges parallel to the x-axis.

A horizontal edge is formed by selecting **two points on the same y-coordinate**.

A trapezoid is then formed by choosing:
- 1 horizontal segment from one row (y‚ÇÅ)
- 1 horizontal segment from another row (y‚ÇÇ ‚â† y‚ÇÅ)

Your task:
Count how many **unique horizontal trapezoids** can be formed from all points.

Return the count modulo **10‚Åπ + 7**.

---

## üí° Intuition

A horizontal trapezoid requires:

- Two horizontal sides ‚Üí each made by picking 2 points on the **same** horizontal line.
- These two lines must be **different**.

So the problem reduces to:

1. Group points by their y-coordinate.
2. Suppose a line has `cnt` points:
   It can form:
  ```text
  C(cnt, 2) = cnt * (cnt - 1) / 2
  ```
  horizontal segments.
3. If two different lines have:
  ```text
  A segment on line y‚ÇÅ
``B segments on line y‚ÇÇ
  ```
  
  Then number of trapezoids formed by these two lines is:
  ```text
  A * B
  ```

### We must sum this over **all pairs of rows**.

  Instead of:
  ```text
  AB + AC + AD + BC + B*D + ...
  ```
  which is O(n¬≤),

### we use a **prefix-sum trick** to compute:

Suppose there are 5 lines, and we used n(n-1)/2 to calculate the effective pairs count on each line
Suppose we have lines `A`, `B`, `C`, `D`, `E`

```text
total trapazoids 
=> A*B + A*C + A*D + A*E + B*C + B*D + B*E + C*D + C*E + D*E
=> A*(B+C+D+E) + B*(C+D+E) + C*(D+E) + D*E
```
In addition, we can easily calculate using "Prefix Sum" in `O(n)` time

---

## üçÉ Approach ‚Äî Group by Y, Count Segments, Use Prefix Multiplication

1. Build `store[y] = number of points on that y`.
2. For each row:
   - Let `v = store[y]`
   - Compute:
     ```
     p = C(v,2) = v*(v-1)/2
     ```
   - Build a prefix sum array of these `p` values.
3. For each row i:
   - Let:
     ```
     current = p[i]
     rest = total_p - prefix[i]
     ```
   - Answer += `current * rest`.

All heavy arithmetic is done using **BigInt** to avoid precision loss when values grow large.

---

## üé® Visual Diagram ‚Äî How Trapezoids Are Counted

Example:

Suppose points lie on 3 rows:

Row y‚ÇÅ: 4 points ‚Üí C(4,2) = 6 segments  
Row y‚ÇÇ: 3 points ‚Üí C(3,2) = 3 segments  
Row y‚ÇÉ: 2 points ‚Üí C(2,2) = 1 segment

To form a trapezoid, pick one segment from one row and one from another row:

Pairs:
- y‚ÇÅ‚Äìy‚ÇÇ ‚Üí 6 √ó 3 = 18
- y‚ÇÅ‚Äìy‚ÇÉ ‚Üí 6 √ó 1 = 6
- y‚ÇÇ‚Äìy‚ÇÉ ‚Üí 3 √ó 1 = 3

Total = **27 trapezoids**

The **Prefix sum** method produces the same result in linear time.

---

## üßæ Code (TypeScript)

```ts
function countTrapezoids(points: number[][]): number {
    const MOD = 1_000_000_007n;

    const store = new Map<number, number>();
    
    // O(n) - count points at each level y (vertical coordinate)
    for(const [x, y] of points){
        if(store.has(y)) store.set(y, store.get(y)+1);
        else store.set(y, 1);
    }

    const pairsCount:bigint[] = [];
    let sum: bigint = 0n;
    // O(n) - for each row, count effective pairs and prefix sum it
    for (const [key, value] of store.entries()) {
        const v = BigInt(value);
        if (v >= 2n) {
            const pair = (v * (v - 1n) / 2n) % MOD; // C(v,2) % MOD
            sum = (sum + pair) % MOD;
            pairsCount.push(sum);
        } else {
            // if < 2 points on this line, it contributes 0 pairs
            pairsCount.push(sum);
        }
    }

    let totalHorizontalTrapezoids:bigint = 0n;
    const rows = pairsCount.length;
    // O(n) - calculate toatl trapezoids
    for(let i=0; i<(rows-1); i++){
        const currentRowPairCount = pairsCount[i] - ((i>0) ? pairsCount[i-1] : 0n);
        const sumOfPairsOfOtherRows = pairsCount[rows-1] - pairsCount[i];

        totalHorizontalTrapezoids = (totalHorizontalTrapezoids + ((currentRowPairCount%MOD) * (sumOfPairsOfOtherRows%MOD))%MOD)%MOD;
    }

    return Number(totalHorizontalTrapezoids);
};
```

---

## ‚è±Ô∏è Complexity

Let R = number of distinct y-levels.

- Grouping points: **O(n)**
- Computing segment-count and prefix: **O(R)**
- Final accumulation: **O(R)**

Since R ‚â§ n:

**Time:** O(n)  
**Space:** O(n)

BigInt avoids precision errors and ensures correct modulo arithmetic.

---
